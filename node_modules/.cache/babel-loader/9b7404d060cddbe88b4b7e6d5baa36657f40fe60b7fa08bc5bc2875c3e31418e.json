{"ast":null,"code":"import SubjectDetailComponent from '@/components/subject/SubjectDetailComponent.vue';\nexport default {\n  components: {\n    SubjectDetailComponent\n  },\n  data() {\n    return {\n      user: {\n        token: '',\n        id: '',\n        email: '',\n        nickname: ''\n      },\n      subjectId: this.$route.params.id,\n      selectedMenu: 'SubjectReview',\n      reviews: [],\n      dialog: false,\n      valid: false,\n      newReview: {\n        rating: 0,\n        reviewText: ''\n      },\n      snackbar: false,\n      snackbarMessage: ''\n    };\n  },\n  async created() {\n    try {\n      await this.$store.dispatch('setUserAllInfoActions');\n      this.user = this.$store.getters.getUserObj;\n      if (this.user.token === '') {\n        alert('로그인이 필요합니다.');\n        location.href = -1;\n      } else {\n        this.fetchReviews();\n      }\n    } catch (error) {\n      console.error('사용자 정보를 가져오는 중 오류가 발생했습니다:', error);\n    }\n  },\n  methods: {\n    fetchReviews() {\n      fetch(`${process.env.VUE_APP_API_BASE_URL}/reviews/list?subject_id=${this.subjectId}`).then(response => response.json()).then(data => {\n        if (data && data.status_code === 200 && data.result && Array.isArray(data.result.content)) {\n          this.reviews = data.result.content;\n        } else {\n          console.warn('리뷰 데이터를 찾을 수 없습니다.');\n          this.reviews = [];\n        }\n      }).catch(error => {\n        console.error('리뷰 목록을 불러올 수 없습니다:', error);\n        this.reviews = [];\n      });\n    },\n    openReviewForm() {\n      this.dialog = true;\n    },\n    closeReviewForm() {\n      this.dialog = false;\n    },\n    submitReview() {\n      if (this.$refs.reviewForm.validate()) {\n        const reviewPayload = {\n          rating: this.newReview.rating,\n          reviewText: this.newReview.reviewText,\n          subjectId: this.subjectId,\n          userId: this.user.id\n        };\n        fetch(`${process.env.VUE_APP_API_BASE_URL}/reviews/create`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${this.user.token}`\n          },\n          body: JSON.stringify(reviewPayload)\n        }).then(response => {\n          if (response.status === 409) {\n            throw new Error('이미 이 과목에 대한 리뷰를 작성하셨습니다.');\n          }\n          return response.json();\n        }).then(data => {\n          if (data.status === 'CREATED') {\n            this.reviews.unshift({\n              ...reviewPayload,\n              id: data.data,\n              createdTime: new Date()\n            });\n            this.snackbarMessage = '리뷰가 성공적으로 등록되었습니다.';\n            this.snackbar = true;\n            this.closeReviewForm();\n          }\n        }).catch(error => {\n          console.error('리뷰 제출 중 오류가 발생했습니다.', error);\n          alert(error.message);\n        });\n      }\n    },\n    formatDate(date) {\n      const options = {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      };\n      return new Date(date).toLocaleDateString(undefined, options);\n    }\n  }\n};","map":{"version":3,"names":["SubjectDetailComponent","components","data","user","token","id","email","nickname","subjectId","$route","params","selectedMenu","reviews","dialog","valid","newReview","rating","reviewText","snackbar","snackbarMessage","created","$store","dispatch","getters","getUserObj","alert","location","href","fetchReviews","error","console","methods","fetch","process","env","VUE_APP_API_BASE_URL","then","response","json","status_code","result","Array","isArray","content","warn","catch","openReviewForm","closeReviewForm","submitReview","$refs","reviewForm","validate","reviewPayload","userId","method","headers","body","JSON","stringify","status","Error","unshift","createdTime","Date","message","formatDate","date","options","year","month","day","toLocaleDateString","undefined"],"sources":["/Users/milcho/Project/TEENKIRI/teenkiri_front/teenkiri_front/src/views/subject/SubjectReview.vue"],"sourcesContent":["<template>\n  <v-app>\n    <v-container>\n      <SubjectDetailComponent v-model=\"selectedMenu\" />\n\n      <h2>강의 후기</h2>\n      <v-row>\n        <v-col>\n          <v-btn color=\"primary\" @click=\"openReviewForm\">후기 작성</v-btn>\n        </v-col>\n      </v-row>\n\n      <!-- 리뷰 목록 -->\n      <v-row v-if=\"reviews && reviews.length\">\n        <v-col v-for=\"review in reviews\" :key=\"review.id\" cols=\"12\" md=\"6\">\n          <v-card>\n            <v-card-title>\n              <div class=\"review-info\">\n                <span>작성자: {{ review.nickname }}</span>\n                <span class=\"rating-text\">별점: {{ review.rating }} / 5</span>\n              </div>\n            </v-card-title>\n            <v-card-text>{{ review.reviewText }}</v-card-text>\n            <v-card-subtitle>\n              작성일: {{ formatDate(review.createdTime) }}\n            </v-card-subtitle>\n          </v-card>\n        </v-col>\n      </v-row>\n      <v-row v-else>\n        <v-col>\n          <p>작성된 후기가 없습니다.</p>\n        </v-col>\n      </v-row>\n\n      <v-dialog v-model=\"dialog\" max-width=\"500px\">\n        <v-card>\n          <v-card-title>\n            <span class=\"headline\">후기 작성</span>\n          </v-card-title>\n          <v-card-text>\n            <v-form ref=\"reviewForm\" v-model=\"valid\">\n              <v-rating v-model=\"newReview.rating\" label=\"평점\" required></v-rating>\n              <v-textarea\n                v-model=\"newReview.reviewText\"\n                label=\"후기\"\n                rows=\"5\"\n                required\n              ></v-textarea>\n            </v-form>\n          </v-card-text>\n          <v-card-actions>\n            <v-spacer></v-spacer>\n            <v-btn color=\"blue darken-1\" text @click=\"closeReviewForm\">취소</v-btn>\n            <v-btn color=\"blue darken-1\" text @click=\"submitReview\">작성</v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-dialog>\n\n      <v-snackbar v-model=\"snackbar\" :timeout=\"3000\">\n        {{ snackbarMessage }}\n        <v-btn color=\"red\" text @click=\"snackbar = false\">Close</v-btn>\n      </v-snackbar>\n    </v-container>\n  </v-app>\n</template>\n\n<script>\nimport SubjectDetailComponent from '@/components/subject/SubjectDetailComponent.vue';\n\nexport default {\n  components: {\n    SubjectDetailComponent,\n  },\n  data() {\n    return {\n      user: {\n        token: '',\n        id: '',\n        email: '',\n        nickname: '',\n      },\n      subjectId: this.$route.params.id, \n      selectedMenu: 'SubjectReview',\n      reviews: [],\n      dialog: false,\n      valid: false, \n      newReview: {\n        rating: 0,\n        reviewText: '',\n      },\n      snackbar: false, \n      snackbarMessage: '',\n    };\n  },\n  async created() {\n    try {\n      await this.$store.dispatch('setUserAllInfoActions');\n      this.user = this.$store.getters.getUserObj;\n\n      if (this.user.token === '') {\n        alert('로그인이 필요합니다.');\n        location.href = -1;\n      } else {\n        this.fetchReviews();\n      }\n    } catch (error) {\n      console.error('사용자 정보를 가져오는 중 오류가 발생했습니다:', error);\n    }\n  },\n  methods: {\n    fetchReviews() {\n      fetch(`${process.env.VUE_APP_API_BASE_URL}/reviews/list?subject_id=${this.subjectId}`)\n        .then(response => response.json())\n        .then(data => {\n          if (data && data.status_code === 200 && data.result && Array.isArray(data.result.content)) {\n            this.reviews = data.result.content;\n          } else {\n            console.warn('리뷰 데이터를 찾을 수 없습니다.');\n            this.reviews = [];\n          }\n        })\n        .catch(error => {\n          console.error('리뷰 목록을 불러올 수 없습니다:', error);\n          this.reviews = [];\n        });\n    },\n    openReviewForm() {\n      this.dialog = true;\n    },\n    closeReviewForm() {\n      this.dialog = false;\n    },\n    submitReview() {\n      if (this.$refs.reviewForm.validate()) {\n        const reviewPayload = {\n          rating: this.newReview.rating,\n          reviewText: this.newReview.reviewText,\n          subjectId: this.subjectId,\n          userId: this.user.id, \n        };\n\n        fetch(`${process.env.VUE_APP_API_BASE_URL}/reviews/create`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${this.user.token}`,\n          },\n          body: JSON.stringify(reviewPayload),\n        })\n          .then(response => {\n            if (response.status === 409) {\n              throw new Error('이미 이 과목에 대한 리뷰를 작성하셨습니다.');\n            }\n            return response.json();\n          })\n          .then(data => {\n            if (data.status === 'CREATED') {\n              this.reviews.unshift({\n                ...reviewPayload,\n                id: data.data,\n                createdTime: new Date(),\n              });\n              this.snackbarMessage = '리뷰가 성공적으로 등록되었습니다.';\n              this.snackbar = true; \n              this.closeReviewForm();\n            }\n          })\n          .catch(error => {\n            console.error('리뷰 제출 중 오류가 발생했습니다.', error);\n            alert(error.message); \n          });\n      }\n    },\n    formatDate(date) {\n      const options = { year: 'numeric', month: 'long', day: 'numeric' };\n      return new Date(date).toLocaleDateString(undefined, options);\n    }},\n}\n\n</script>\n\n<style scoped>\n.review-info {\n  display: flex;\n  justify-content: space-between;\n  font-size: 1.2rem;\n  font-weight: bold;\n}\n\n.rating-text {\n  font-weight: bold;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}